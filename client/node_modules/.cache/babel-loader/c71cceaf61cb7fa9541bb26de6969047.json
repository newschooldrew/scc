{"ast":null,"code":"import _regeneratorRuntime from\"/Users/andrewperez/Documents/projects/scc/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/andrewperez/Documents/projects/scc/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/andrewperez/Documents/projects/scc/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useEffect,useState}from\"react\";import AuthContext from'../AuthContext';import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import{createPaymentIntent,createOrder,removeItemFromInventory}from'../actions';import{withRouter}from'react-router-dom';import{Col,Row,Button,Form,FormGroup,Label,Input}from'reactstrap';import'./CheckoutForm.scss';var CheckoutForm=function CheckoutForm(_ref){var price=_ref.price,history=_ref.history;var _useContext=useContext(AuthContext),state=_useContext.state,dispatch=_useContext.dispatch;var cartItems=state.cartItems;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),clientSecret=_useState2[0],setClientSecret=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),metadata=_useState6[0],setMetadata=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),succeeded=_useState8[0],setSucceeded=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),processing=_useState10[0],setProcessing=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),actualName=_useState12[0],setActualName=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),lastName=_useState14[0],setLastName=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),address=_useState16[0],setAddress=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),city=_useState18[0],setCity=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),province=_useState20[0],setProvince=_useState20[1];var _useState21=useState(''),_useState22=_slicedToArray(_useState21,2),postal_code=_useState22[0],setPostalCode=_useState22[1];var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),email=_useState24[0],setEmail=_useState24[1];var stripe=useStripe();var elements=useElements();var cartTotal=JSON.parse(sessionStorage.getItem('cart'));useEffect(function(){var item={actualName:actualName,address:address,city:city,province:province,postal_code:postal_code,email:email,price:price,cartTotal:cartTotal};createPaymentIntent(item).then(function(clientSecret){console.log(\"clientSecret:\");console.log(clientSecret.client_secret);setClientSecret(clientSecret.client_secret);console.log(\"clientSecret:\");console.log(clientSecret);}).catch(function(err){setError(err.message);});},[]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(ev){var item,payload;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(clientSecret);ev.preventDefault();setProcessing(true);removeItemFromInventory(cartTotal);item={actualName:actualName,lastName:lastName,address:address,city:city,province:province,postal_code:postal_code,email:email,price:price,cartTotal:cartTotal};createPaymentIntent(item).then(function(clientSecret){console.log(\"clientSecret:\");console.log(clientSecret.client_secret);setClientSecret(clientSecret.client_secret);console.log(\"clientSecret:\");console.log(clientSecret);}).catch(function(err){setError(err.message);});// Step 3: Use clientSecret from PaymentIntent and the CardElement\n// to confirm payment with stripe.confirmCardPayment()\n_context.next=8;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement),billing_details:{name:ev.target.name.value}}});case 8:payload=_context.sent;console.log(\"payload:\");console.log(payload);if(payload.error){setError(\"Payment failed: \".concat(payload.error.message));setProcessing(false);console.log(\"[error]\",payload.error);}else{setError(null);setProcessing(false);setMetadata(payload.paymentIntent);console.log(\"[PaymentIntent]\",payload.paymentIntent);}createOrder(item);history.push('/receipt');case 14:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var renderSuccess=function renderSuccess(){var item={actualName:actualName,address:address,city:city,province:province,postal_code:postal_code,price:price,cartTotal:cartTotal};};var renderForm=function renderForm(){var options={style:{base:{color:\"#32325d\",fontFamily:'\"Helvetica Neue\", Helvetica, sans-serif',fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#aab7c4\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}}};var formStyles={margin:'0 0 8% 0',display:'flex',maxWidth:'100% !important'};var outerStyles={justifyContent:'spaceBetween',width:'13%'};var innerStyles={justifyContent:'spaceBetween',width:'74%'};return/*#__PURE__*/React.createElement(\"div\",{style:formStyles},/*#__PURE__*/React.createElement(\"div\",{style:outerStyles}),/*#__PURE__*/React.createElement(Form,{style:innerStyles,onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"div\",{className:\"form-row\"},/*#__PURE__*/React.createElement(FormGroup,{className:\"col-md-6\"},/*#__PURE__*/React.createElement(Label,{for:\"name\"},\"Name\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",id:\"name\",name:\"name\",placeholder:\"Name\",autoComplete:\"cardholder\",className:\"sr-input\",onChange:function onChange(e){return setActualName(e.target.value);},value:actualName})),/*#__PURE__*/React.createElement(FormGroup,{className:\"col-md-6\"},/*#__PURE__*/React.createElement(Label,{for:\"lastName\"},\"Last Name\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",id:\"lastName\",name:\"lastName\",placeholder:\"Last name\",className:\"sr-input\",onChange:function onChange(e){return setLastName(e.target.value);},value:lastName}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-row\"},/*#__PURE__*/React.createElement(FormGroup,{className:\"col-md-6\"},/*#__PURE__*/React.createElement(Label,{for:\"address\"},\"Address\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",id:\"address\",name:\"Address\",placeholder:\"Address\",className:\"sr-input\",onChange:function onChange(e){return setAddress(e.target.value);},value:address})),/*#__PURE__*/React.createElement(FormGroup,{className:\"col-md-6\"},/*#__PURE__*/React.createElement(Label,{for:\"address\"},\"City\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",id:\"city\",name:\"City\",placeholder:\"City\",className:\"sr-input\",onChange:function onChange(e){return setCity(e.target.value);},value:city}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-row\"},/*#__PURE__*/React.createElement(FormGroup,{className:\"col-md-6\"},/*#__PURE__*/React.createElement(Label,{for:\"address\"},\"State\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",id:\"province\",name:\"province\",placeholder:\"State\",className:\"sr-input\",onChange:function onChange(e){return setProvince(e.target.value);},value:province})),/*#__PURE__*/React.createElement(FormGroup,{className:\"col-md-6\"},/*#__PURE__*/React.createElement(Label,{for:\"address\"},\"Postal Code\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",id:\"postal_code\",name:\"postal_code\",placeholder:\"Postal Code\",className:\"sr-input\",onChange:function onChange(e){return setPostalCode(e.target.value);},value:postal_code})),/*#__PURE__*/React.createElement(FormGroup,{className:\"col-md-12\"},/*#__PURE__*/React.createElement(Label,{for:\"address\"},\"Email\"),/*#__PURE__*/React.createElement(Input,{type:\"text\",id:\"email\",name:\"email\",placeholder:\"Email\",className:\"sr-input\",onChange:function onChange(e){return setEmail(e.target.value);},value:email}))),/*#__PURE__*/React.createElement(CardElement,{className:\"sr-input sr-card-element\",options:options}),error&&/*#__PURE__*/React.createElement(\"div\",{className:\"message sr-field-error\"},error),/*#__PURE__*/React.createElement(\"button\",{className:\"btn\"},processing?\"Processingâ€¦\":\"Pay\")),/*#__PURE__*/React.createElement(\"div\",{style:outerStyles}));};return/*#__PURE__*/React.createElement(\"div\",{className:\"checkout-form\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sr-payment-form\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sr-form-row\"}),renderForm()));};export default withRouter(CheckoutForm);","map":{"version":3,"sources":["/Users/andrewperez/Documents/projects/scc/client/src/Checkout/CheckoutForm.js"],"names":["React","useContext","useEffect","useState","AuthContext","CardElement","useStripe","useElements","createPaymentIntent","createOrder","removeItemFromInventory","withRouter","Col","Row","Button","Form","FormGroup","Label","Input","CheckoutForm","price","history","state","dispatch","cartItems","clientSecret","setClientSecret","error","setError","metadata","setMetadata","succeeded","setSucceeded","processing","setProcessing","actualName","setActualName","lastName","setLastName","address","setAddress","city","setCity","province","setProvince","postal_code","setPostalCode","email","setEmail","stripe","elements","cartTotal","JSON","parse","sessionStorage","getItem","item","then","console","log","client_secret","catch","err","message","handleSubmit","ev","preventDefault","confirmCardPayment","payment_method","card","getElement","billing_details","name","target","value","payload","paymentIntent","push","renderSuccess","renderForm","options","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","formStyles","margin","display","maxWidth","outerStyles","justifyContent","width","innerStyles","e"],"mappings":"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","sourcesContent":["import React, {useContext, useEffect, useState } from \"react\";\nimport AuthContext from '../AuthContext'\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport {createPaymentIntent,createOrder,removeItemFromInventory} from '../actions'\nimport {withRouter} from 'react-router-dom'\nimport { Col, Row, Button, Form, FormGroup, Label, Input } from 'reactstrap';\nimport './CheckoutForm.scss'\n\nconst CheckoutForm = ({price,history}) => {\n  const {state,dispatch} = useContext(AuthContext)\n  const {cartItems} = state;\n  const [clientSecret, setClientSecret] = useState(null);\n  const [error, setError] = useState(null);\n  const [metadata, setMetadata] = useState(null);\n  const [succeeded, setSucceeded] = useState(false);\n  const [processing, setProcessing] = useState(false);\n  const [actualName,setActualName] = useState('')\n  const [lastName,setLastName] = useState('')\n  const [address,setAddress] = useState('')\n  const [city,setCity] = useState('')\n  const [province,setProvince] = useState('')\n  const [postal_code,setPostalCode] = useState('')\n  const [email,setEmail] = useState('')\n  const stripe = useStripe();\n  const elements = useElements();\n\n  let cartTotal = JSON.parse(sessionStorage.getItem('cart'))\n\n  useEffect(() => {\n    const item = {actualName,address,city,province,postal_code,email,price,cartTotal}\n      createPaymentIntent(item)\n      .then((clientSecret) => {\n          console.log(\"clientSecret:\")\n          console.log(clientSecret.client_secret)\n          setClientSecret(clientSecret.client_secret)\n        console.log(\"clientSecret:\")\n        console.log(clientSecret)\n      })\n      .catch((err) => {\n        setError(err.message);\n      });\n  }, []);\n  \n  const handleSubmit = async (ev) => {\n      console.log(clientSecret)\n    ev.preventDefault();\n    setProcessing(true);\n    removeItemFromInventory(cartTotal)\n    const item = {actualName,lastName,address,city,province,postal_code,email,price,cartTotal}\n\n    createPaymentIntent(item)\n    .then((clientSecret) => {\n        console.log(\"clientSecret:\")\n        console.log(clientSecret.client_secret)\n        setClientSecret(clientSecret.client_secret)\n      console.log(\"clientSecret:\")\n      console.log(clientSecret)\n    })\n    .catch((err) => {\n      setError(err.message);\n    });\n\n    // Step 3: Use clientSecret from PaymentIntent and the CardElement\n    // to confirm payment with stripe.confirmCardPayment()\n    const payload = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardElement),\n        billing_details: {\n          name: ev.target.name.value,\n        },\n      },\n    });\n\n    console.log(\"payload:\")\n    console.log(payload)\n\n    if (payload.error) {\n      setError(`Payment failed: ${payload.error.message}`);\n      setProcessing(false);\n      console.log(\"[error]\", payload.error);\n    } else {\n      setError(null);\n      setProcessing(false);\n      setMetadata(payload.paymentIntent);\n      console.log(\"[PaymentIntent]\", payload.paymentIntent)\n    }\n    createOrder(item)\n    history.push('/receipt')\n  };\n\n  const renderSuccess = () => {\n    const item = {actualName,address,city,province,postal_code,price,cartTotal}\n  };\n\n  const renderForm = () => {\n    const options = {\n      style: {\n        base: {\n          color: \"#32325d\",\n          fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n          fontSmoothing: \"antialiased\",\n          fontSize: \"16px\",\n          \"::placeholder\": {\n            color: \"#aab7c4\",\n          },\n        },\n        invalid: {\n          color: \"#fa755a\",\n          iconColor: \"#fa755a\",\n        },\n      },\n    };\n\n    const formStyles = {\n      margin: '0 0 8% 0',\n      display:'flex',\n      maxWidth:'100% !important'\n    }\n\n    const outerStyles = {\n      justifyContent:'spaceBetween',\n      width:'13%'\n    }\n\n    const innerStyles = {\n      justifyContent:'spaceBetween',\n      width:'74%'\n    }\n\n    return (\n      <div style={formStyles}>\n        <div style={outerStyles}></div>\n      <Form style={innerStyles} onSubmit={handleSubmit}>\n\n      <div className=\"form-row\">\n                <FormGroup className=\"col-md-6\">\n                <Label for=\"name\">Name</Label>\n                            <Input\n                            type=\"text\"\n                            id=\"name\"\n                            name=\"name\"\n                            placeholder=\"Name\"\n                            autoComplete=\"cardholder\"\n                            className=\"sr-input\"\n                            onChange={e => setActualName(e.target.value)}\n                            value={actualName}\n                            />\n                </FormGroup>\n                \n                    <FormGroup className=\"col-md-6\">\n                    <Label for=\"lastName\">Last Name</Label>\n                        <Input\n                        type=\"text\"\n                        id=\"lastName\"\n                        name=\"lastName\"\n                        placeholder=\"Last name\"\n                        className=\"sr-input\"\n                        onChange={e => setLastName(e.target.value)}\n                        value={lastName}\n                        />\n                    </FormGroup>\n              </div>\n          <div className=\"form-row\">\n                  <FormGroup className=\"col-md-6\">\n                  <Label for=\"address\">Address</Label>\n                              <Input\n                              type=\"text\"\n                              id=\"address\"\n                              name=\"Address\"\n                              placeholder=\"Address\"\n                              className=\"sr-input\"\n                              onChange={e => setAddress(e.target.value)}\n                              value={address}\n                              />\n                  </FormGroup>\n\n                  <FormGroup className=\"col-md-6\">\n                  <Label for=\"address\">City</Label>\n                  <Input\n                    type=\"text\"\n                    id=\"city\"\n                    name=\"City\"\n                    placeholder=\"City\"\n                    className=\"sr-input\"\n                    onChange={e => setCity(e.target.value)}\n                    value={city}\n                    />\n                  </FormGroup>\n            </div>\n            <div className=\"form-row\">\n                  <FormGroup className=\"col-md-6\">\n                  <Label for=\"address\">State</Label>\n                      <Input\n                      type=\"text\"\n                      id=\"province\"\n                      name=\"province\"\n                      placeholder=\"State\"\n                      className=\"sr-input\"\n                      onChange={e => setProvince(e.target.value)}\n                      value={province}\n                      />\n                  </FormGroup>\n                \n                  <FormGroup className=\"col-md-6\">\n                  <Label for=\"address\">Postal Code</Label>\n                      <Input\n                      type=\"text\"\n                      id=\"postal_code\"\n                      name=\"postal_code\"\n                      placeholder=\"Postal Code\"\n                      className=\"sr-input\"\n                      onChange={e => setPostalCode(e.target.value)}\n                      value={postal_code}\n                      />\n                  </FormGroup>\n                \n                  <FormGroup className=\"col-md-12\">\n                  <Label for=\"address\">Email</Label>\n                      <Input\n                      type=\"text\"\n                      id=\"email\"\n                      name=\"email\"\n                      placeholder=\"Email\"\n                      className=\"sr-input\"\n                      onChange={e => setEmail(e.target.value)}\n                      value={email}\n                      />\n                  </FormGroup>\n          </div>\n\n            <CardElement\n              className=\"sr-input sr-card-element\"\n              options={options}\n              />\n\n        {error && <div className=\"message sr-field-error\">{error}</div>}\n\n        <button\n          className=\"btn\"\n          >\n            {processing ? \"Processingâ€¦\" : \"Pay\"}\n        </button>\n          \n      </Form>\n      <div style={outerStyles}></div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"checkout-form\">\n      <div className=\"sr-payment-form\">\n        <div className=\"sr-form-row\" />\n        {renderForm()}\n      </div>\n    </div>\n  );\n}\n\nexport default withRouter(CheckoutForm)"]},"metadata":{},"sourceType":"module"}